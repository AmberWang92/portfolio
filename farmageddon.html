<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Until the Fields: Farmageddon - Xinyue Wang</title>
    <link rel="stylesheet" href="css/project-styles.css">
</head>

<body>

    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo">Xinyue Wang</a>
                <ul class="nav-links">
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="index.html#portfolio" class="active">Portfolio</a></li>
                    <li><a href="index.html#resume">Resume</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                    <span class="nav-indicator" aria-hidden="true"></span>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <a href="index.html#portfolio" class="back-link">
                ← Back to Portfolio
            </a>
        </div>

        <section class="video-section">
            <div class="container">
                <div class="video-wrapper">
                    <iframe src="https://www.youtube.com/embed/nkQzMorvYII?si=LlvQNbx23L6wuHo3"
                        title="YouTube video player" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
                    </iframe>
                </div>
            </div>
        </section>

        <section class="project-header">
            <div class="container">
                <h1 class="project-title">Until the Fields: Farmageddon</h1>

                <div class="tags-container">
                    <span class="tag">Unity</span>
                    <span class="tag">C#</span>
                    <span class="tag">3D Puzzle Platformer</span>
                </div>

                <div class="game-links">
                    <iframe src="https://store.steampowered.com/widget/4129640/" frameborder="0" width="646"
                        height="190" scrolling="no"></iframe>
                </div>
            </div>
        </section>

        <section class="description-section">
            <div class="container">
                <h2 class="section-heading">About the Project</h2>
                <div class="description-layout">
                    <img src="pictures/BestGame.jpeg" alt="Best Game award photo">
                    <div class="description-text">
                        <p>
                            Until the Fields: Farmageddon is a <strong>3D single-player puzzle platformer</strong>
                            adventure where
                            you swap between 3 animals: mouse, spider and cow — each with their own personality and
                            tricks — Our heroes must cooperate to solve puzzles and escape the storm-wrecked barn!
                        </p>
                        <br>
                        <p>
                            The game is a student project developed by a team of <strong>6 women</strong> over
                            <strong>3.5 months</strong>. I spend more than <strong>500 hours</strong> on this project.
                            Won the <strong>Best Game Award</strong> at the Expa X-Max JKL event.
                        </p>
                        <br>
                    </div>
                </div>

                <h2 class="section-heading">My Contributions</h2>
                <div class="accordion" id="contrib-accordion">
                    <div class="accordion-item">
                        <button class="accordion-header" aria-expanded="false">
                            <span class="accordion-title">
                                <span class="dropdown-leading-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M4 17l6-6-6-6M12 19h8" />
                                    </svg>
                                </span>
                                Lead Programmer
                            </span>
                            <span class="accordion-icon">+</span>
                        </button>
                        <div class="accordion-content">
                            <ul>
                                <li>Led core <strong>gameplay programming</strong> and <strong>system
                                        architecture</strong>
                                </li>
                                <li>Contributed to <strong>technical design decisions</strong> and long-term system
                                    <strong>scalability</strong>
                                </li>
                                <li>Assigned and coordinated tasks between <strong>3 programmers</strong></li>
                                <li>Reviewed and merged code, resolving integration <strong>Git conflicts</strong></li>
                            </ul>
                            <div class="sub-accordion">
                                <div class="sub-item">
                                    <button class="sub-header" aria-expanded="false">
                                        <span class="sub-label">
                                            <span class="dropdown-leading-icon" aria-hidden="true">
                                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                                    <rect x="5" y="5" width="6" height="6" rx="1" />
                                                    <rect x="13" y="5" width="6" height="6" rx="1" />
                                                    <rect x="5" y="13" width="6" height="6" rx="1" />
                                                    <rect x="13" y="13" width="6" height="6" rx="1" />
                                                    <path d="M11 8h2M8 11v2M16 11v2" />
                                                </svg>
                                            </span>
                                            <span>Technical Design Diagram</span>
                                        </span>
                                        <span class="sub-icon">+</span>
                                    </button>
                                    <div class="sub-content">
                                        <div class="svg-zoom-container"
                                            style="position:relative;width:100%;max-width:900px;height:600px;overflow:hidden;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,0.15);cursor:grab;">
                                            <img src="files/Technical Design.svg" alt="Technical Design Diagram"
                                                class="zoomable-svg"
                                                style="position:absolute;top:0;left:0;width:100%;height:auto;transform-origin:0 0;user-select:none;">
                                            <div class="zoom-controls"
                                                style="position:absolute;top:10px;right:10px;display:flex;gap:8px;z-index:10;">
                                                <button class="zoom-btn zoom-in"
                                                    style="width:36px;height:36px;border:none;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.15);cursor:pointer;font-size:18px;font-weight:bold;">+</button>
                                                <button class="zoom-btn zoom-out"
                                                    style="width:36px;height:36px;border:none;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.15);cursor:pointer;font-size:18px;font-weight:bold;">−</button>
                                                <button class="zoom-btn zoom-reset"
                                                    style="width:36px;height:36px;border:none;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.15);cursor:pointer;font-size:18px;font-weight:800;">⟲</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sub-item">
                                    <button class="sub-header" aria-expanded="false">
                                        <span class="sub-label">
                                            <span class="dropdown-leading-icon" aria-hidden="true">
                                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                                    <path d="M7 8l-3 4 3 4" />
                                                    <path d="M17 8l3 4-3 4" />
                                                    <path d="M14 6l-4 12" />
                                                </svg>
                                            </span>
                                            <span>CODE SNIPPET</span>
                                        </span>
                                        <span class="sub-icon">+</span>
                                    </button>
                                    <div class="sub-content">
                                        <ul style="margin-bottom: 20px; line-height: 1.8;">
                                            <li><strong>Advanced Cinematic System:</strong> Demonstrates sophisticated
                                                cutscene orchestration with multi-phase camera transitions (bag fall →
                                                spider flight)</li>
                                            <li><strong>Spline-Based Animation:</strong> Shows mastery of Unity Splines
                                                for smooth, controlled character movement along predefined paths</li>
                                            <li><strong>Time Manipulation:</strong> Implements dynamic slow-motion
                                                effects with smooth blending</li>
                                            <li><strong>Cinemachine 3.x Integration:</strong> Professional camera
                                                management with priority systems and dolly synchronization</li>
                                            <li><strong>State Management:</strong> Complex coroutine-based sequencing
                                                with proper cleanup and state restoration</li>
                                            <li><strong>Polish Features:</strong> Audio integration, platform
                                                validation, automatic character switching on landing</li>
                                        </ul>
                                        <div class="gist-container">
                                            <iframe id="gist-frame" class="gist-frame"
                                                data-gist-src="https://gist.github.com/AmberWang92/120b324db4cbee71f67da7648089cbfc.js"
                                                style="width:100%;border:none;min-height:200px;max-height:500px;border-radius:8px;overflow-y:auto;display:block;"
                                                title="Code snippet"
                                                sandbox="allow-scripts allow-same-origin allow-top-navigation-by-user-activation">
                                            </iframe>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header" aria-expanded="false">
                            <span class="accordion-title">
                                <span class="dropdown-leading-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <circle cx="12" cy="8" r="3" />
                                        <path d="M4 20c0-4 3.5-7 8-7s8 3 8 7" />
                                        <path d="M12 11v3M10 14h4" />
                                    </svg>
                                </span>
                                Product Owner
                            </span>
                            <span class="accordion-icon">+</span>
                        </button>
                        <div class="accordion-content">
                            <div style="display: flex; gap: 30px; align-items: flex-start; flex-wrap: wrap;">
                                <ul style="flex: 1 1 400px;">
                                    <li>Managed <strong>Agile workflow</strong>, defined sprint goals, prioritized
                                        backlog,
                                        and aligned development with product vision</li>
                                    <li>Coordinated cross-disciplinary <strong>communication</strong> between 3
                                        programmers,
                                        2 artists, 1 PM, and 2 outsourced music & sounds designers</li>
                                    <li>Brainstormed and co-designed <strong>whole gameplay</strong> and
                                        <strong>level design</strong>, provide <strong>arts direction and
                                            references</strong>
                                    </li>
                                    <li>Participated in <strong>Business Pitch</strong> presentations</li>
                                </ul>
                                <img src="pictures/Presentation.JPG" alt="Business Pitch Presentation"
                                    style="flex: 1 1 150px; max-width: 200px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); object-fit: cover;">
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header" aria-expanded="false">
                            <span class="accordion-title">
                                <span class="dropdown-leading-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <rect x="3" y="3" width="7" height="7" rx="1" />
                                        <rect x="14" y="3" width="7" height="7" rx="1" />
                                        <rect x="3" y="14" width="7" height="7" rx="1" />
                                        <rect x="14" y="14" width="7" height="7" rx="1" />
                                    </svg>
                                </span>
                                Level Designer &amp; Implementation
                            </span>
                            <span class="accordion-icon">+</span>
                        </button>
                        <div class="accordion-content">
                            <ul>
                                <li>Designed and implemented <strong>physics-based puzzle logic</strong> and fail states
                                    (catapults,
                                    spinning fans,
                                    rope destruction, unstable platforms, breaking cubes)
                                    <div class="gif-row">
                                        <video src="files/catapult.mp4" autoplay loop muted playsinline
                                            aria-label="Catapult puzzle demo"></video>
                                        <video src="files/Spinning_Fan.mp4" autoplay loop muted playsinline
                                            aria-label="Spinning fan obstacle"></video>
                                        <video src="files/Moo_vement.mp4" autoplay loop muted playsinline
                                            aria-label="Rope destruction challenge"></video>
                                    </div>
                                </li>
                                <li>Developed <strong>mouse, cow characters mechanics</strong> (movement, actions:
                                    jumping, wall-sliding,
                                    puzzle interactions)
                                </li>
                                <li><strong>Integrated</strong> gameplay systems, 3D assets, UI elements, music & sounds
                                    into complete
                                    playable levels</li>
                                <li>Integrated Unity <strong>Input System</strong> (keyboard & controller), structured
                                    action
                                    mapping and
                                    input flow</li>
                                <li>Implemented <strong>animation logic</strong> and resolved root motion conflicts</li>
                                <li>Implemented <strong>Cinemachine camera system</strong> like a real movie director
                                </li>
                                <li>Tuned movement feel, camera constraints, and velocity to <strong>improve player
                                        experience</strong>
                                </li>

                            </ul>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header" aria-expanded="false">
                            <span class="accordion-title">
                                <span class="dropdown-leading-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M12 3l8 8-8 8" />
                                        <path d="M4 12h16" />
                                        <circle cx="12" cy="12" r="2" fill="currentColor" />
                                    </svg>
                                </span>
                                Production &amp; Release
                            </span>
                            <span class="accordion-icon">+</span>
                        </button>
                        <div class="accordion-content">
                            <ul>
                                <li>Managed <strong>Steam deployment</strong> workflow (store page setup, build uploads,
                                    version control, testing branches)</li>
                            </ul>
                        </div>
                    </div>
                </div>



                <h2 class="section-heading">My Badges</h2>
                <div class="media-grid">
                    <div class="media-item">
                        <div class="badge-container">
                            <img src="pictures/badge1.png" alt="Badge 1">
                            <div class="badge-shine"></div>
                        </div>
                    </div>
                    <div class="media-item">
                        <div class="badge-container">
                            <img src="pictures/badge2.png" alt="Badge 2">
                            <div class="badge-shine"></div>
                        </div>
                    </div>
                    <div class="media-item">
                        <div class="badge-container">
                            <img src="pictures/badge3.png" alt="Badge 3">
                            <div class="badge-shine"></div>
                        </div>
                    </div>
                    <div class="media-item">
                        <div class="badge-container">
                            <img src="pictures/badge4.png" alt="Badge 4">
                            <div class="badge-shine"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="project-nav-section">
            <div class="container">
                <div class="project-nav">
                    <div class="nav-arrow prev disabled">
                        <span class="arrow-icon">←</span>
                        <div class="nav-text-group">
                            <span class="nav-label">Previous Project</span>
                            <span class="nav-title">Coming Soon</span>
                        </div>
                    </div>
                    <a class="nav-arrow next" href="mr_game.html">
                        <div class="nav-text-group">
                            <span class="nav-label">Next Project</span>
                            <span class="nav-title">MR Game: Ghost Gym</span>
                        </div>
                        <span class="arrow-icon">→</span>
                    </a>
                </div>
            </div>
        </section>

    </main>

    <footer id="contact">
        <div class="container">
            <h2>Contact Me</h2>
            <div style="display: flex; justify-content: center; gap: 30px; margin: 30px 0; flex-wrap: wrap;">
                <a href="https://github.com/AmberWang92" target="_blank"
                    style="background: transparent; border: none; padding: 0; transition: opacity 0.3s;">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                        <path
                            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                    </svg>
                </a>
                <a href="https://linkedin.com/in/xinyuewang92" target="_blank"
                    style="background: transparent; border: none; padding: 0; transition: opacity 0.3s;">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                        <path
                            d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
                    </svg>
                </a>
                <a href="https://zombieeeee.itch.io" target="_blank"
                    style="background: transparent; border: none; padding: 0; transition: opacity 0.3s;">
                    <svg width="32" height="32" viewBox="0 0 512 512" fill="white">
                        <path
                            d="M71.92 34.77C50.2 47.67 7.4 96.84 7 109.73v21.34c0 27.06 25.29 50.84 48.25 50.84 27.57 0 50.54-22.85 50.54-50 0 27.12 22.18 50 49.76 50s49-22.85 49-50c0 27.12 23.59 50 51.16 50h.5c27.57 0 51.16-22.85 51.16-50 0 27.12 21.47 50 49 50s49.76-22.85 49.76-50c0 27.12 23 50 50.54 50 23 0 48.25-23.78 48.25-50.84v-21.34c-.4-12.9-43.2-62.07-64.92-75C372.56 32.4 325.76 32 256 32S91.14 33.1 71.92 34.77zm132.32 134.39c-22 38.4-77.9 38.71-99.85.25-13.17 23.14-43.17 32.07-56 27.66-3.87 40.15-13.67 237.13 17.73 269.15 80 18.67 302.08 18.12 379.76 0 31.65-32.27 21.32-232 17.75-269.15-12.92 4.44-42.88-4.6-56-27.66-22 38.52-77.85 38.1-99.85-.24-7.1 12.49-23.05 28.94-51.76 28.94a57.54 57.54 0 0 1-51.75-28.94zm-41.58 53.77c16.47 0 31.09 0 49.22 19.78a436.91 436.91 0 0 1 88.18 0C318.22 223 332.85 223 349.31 223c52.33 0 65.22 77.53 83.87 144.45 17.26 62.15-5.52 63.67-33.95 63.73-42.15-1.57-65.49-32.18-65.49-62.79-39.25 6.43-101.93 8.79-155.55 0 0 30.61-23.34 61.22-65.49 62.79-28.42-.06-51.2-1.58-33.94-63.73 18.67-67 31.56-144.45 83.88-144.45zM256 270.79s-44.38 40.77-52.35 55.21l29-1.17v25.32c0 1.55 21.34.16 23.33.16 11.65.54 23.31 1 23.31-.16v-25.28l29 1.17c-8-14.48-52.35-55.24-52.35-55.24z" />
                    </svg>
                </a>
                <a href="mailto:amberkeqi@gmail.com"
                    style="background: transparent; border: none; padding: 0; transition: opacity 0.3s;">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                </a>
            </div>
            <p style="margin-top: 20px; font-size: 0.8rem; opacity: 0.7;">&copy; 2026 Xinyue Wang. All Rights Reserved.
            </p>
        </div>
    </footer>

    <script>
        (function () {
            const nav = document.querySelector('header .nav-links');
            if (!nav) return;

            const links = Array.from(nav.querySelectorAll('a'));
            const indicator = nav.querySelector('.nav-indicator');

            function moveIndicatorTo(link) {
                if (!indicator || !link) return;
                requestAnimationFrame(() => {
                    const navRect = nav.getBoundingClientRect();
                    const linkRect = link.getBoundingClientRect();
                    indicator.style.width = `${linkRect.width}px`;
                    indicator.style.transform = `translateX(${linkRect.left - navRect.left}px)`;
                    indicator.style.opacity = '1';
                });
            }

            links.forEach(a => {
                a.addEventListener('click', () => {
                    links.forEach(link => link.classList.remove('active'));
                    a.classList.add('active');
                    moveIndicatorTo(a);
                });
            });

            const initialActive = nav.querySelector('a.active') || links[0];
            if (initialActive) {
                moveIndicatorTo(initialActive);
            }

            window.addEventListener('resize', () => {
                const current = nav.querySelector('a.active');
                if (current) {
                    moveIndicatorTo(current);
                }
            });
        })();

        // Accordion behavior for "My Contributions" (smooth one-piece animation)
        (function () {
            const accordion = document.getElementById('contrib-accordion');
            if (!accordion) return;

            const items = Array.from(accordion.querySelectorAll('.accordion-item'));

            function closeItem(it) {
                const content = it.querySelector('.accordion-content');
                const hdr = it.querySelector('.accordion-header');
                const ic = it.querySelector('.accordion-icon');
                if (!content) return;
                // Set explicit height from current auto/px to enable transition
                content.style.height = content.scrollHeight + 'px';
                // force reflow
                void content.offsetHeight;
                content.style.height = '0px';
                it.classList.remove('open');
                if (hdr) hdr.setAttribute('aria-expanded', 'false');
                if (ic) ic.textContent = '+';
            }

            function openItem(it) {
                const content = it.querySelector('.accordion-content');
                const hdr = it.querySelector('.accordion-header');
                const ic = it.querySelector('.accordion-icon');
                if (!content) return;
                content.style.height = content.scrollHeight + 'px';
                it.classList.add('open');
                if (hdr) hdr.setAttribute('aria-expanded', 'true');
                const onEnd = (e) => {
                    if (e.propertyName === 'height') {
                        content.style.height = 'auto';
                        content.removeEventListener('transitionend', onEnd);
                    }
                };
                content.addEventListener('transitionend', onEnd);
            }

            items.forEach((item) => {
                const header = item.querySelector('.accordion-header');
                if (!header) return;

                header.addEventListener('click', () => {
                    const isOpen = item.classList.contains('open');
                    // Close all items first (single-open behavior)
                    items.forEach(i => {
                        if (i !== item && i.classList.contains('open')) closeItem(i);
                    });

                    if (isOpen) {
                        closeItem(item);
                    } else {
                        // Prepare height from 0
                        const content = item.querySelector('.accordion-content');
                        if (content) {
                            content.style.height = '0px';
                            // force reflow
                            void content.offsetHeight;
                        }
                        openItem(item);
                    }
                });
            });
        })();

        // Sub-accordion behavior inside panels (e.g., Lead Programmer) with smooth height animation
        (function () {
            const subAccordions = Array.from(document.querySelectorAll('#contrib-accordion .sub-accordion'));
            if (!subAccordions.length) return;

            function closeSub(it) {
                const content = it.querySelector('.sub-content');
                const hdr = it.querySelector('.sub-header');
                const ic = it.querySelector('.sub-icon');
                if (!content) return;
                content.style.height = content.scrollHeight + 'px';
                void content.offsetHeight;
                content.style.height = '0px';
                it.classList.remove('open');
                if (hdr) hdr.setAttribute('aria-expanded', 'false');
                if (ic) ic.textContent = '+';
            }

            function openSub(it) {
                const content = it.querySelector('.sub-content');
                const hdr = it.querySelector('.sub-header');
                const ic = it.querySelector('.sub-icon');
                if (!content) return;
                content.style.height = content.scrollHeight + 'px';
                it.classList.add('open');
                if (hdr) hdr.setAttribute('aria-expanded', 'true');
                const onEnd = (e) => {
                    if (e.propertyName === 'height') {
                        content.style.height = 'auto';
                        content.removeEventListener('transitionend', onEnd);
                    }
                };
                content.addEventListener('transitionend', onEnd);
            }

            subAccordions.forEach(sa => {
                const items = Array.from(sa.querySelectorAll('.sub-item'));
                items.forEach(item => {
                    const header = item.querySelector('.sub-header');
                    if (!header) return;

                    header.addEventListener('click', () => {
                        const isOpen = item.classList.contains('open');
                        // Close siblings (single-open per sub-accordion)
                        items.forEach(i => {
                            if (i !== item && i.classList.contains('open')) closeSub(i);
                        });

                        if (isOpen) {
                            closeSub(item);
                        } else {
                            const content = item.querySelector('.sub-content');
                            if (content) {
                                content.style.height = '0px';
                                void content.offsetHeight;
                            }
                            // Lazy-load Gist into iframe on first open
                            const gistFrame = item.querySelector('iframe.gist-frame[data-gist-src]');
                            if (gistFrame) {
                                const src = gistFrame.getAttribute('data-gist-src');
                                gistFrame.removeAttribute('data-gist-src');
                                const doc = gistFrame.contentDocument || gistFrame.contentWindow.document;
                                doc.open();
                                doc.write(`<!DOCTYPE html><html><head>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #1e1e1e; }
  .gist .gist-file { border: none !important; border-radius: 0 !important; margin: 0; }
  .gist .gist-data { background: #1e1e1e !important; border-bottom: none !important; }
  .gist-meta { display: none !important; }
  #scroll-track {
    position: fixed;
    top: 0;
    right: 0;
    width: 5px;
    height: 100%;
    background: rgba(255,255,255,0.08);
    z-index: 999;
  }
  #scroll-thumb {
    position: absolute;
    right: 0;
    width: 5px;
    background: #5aa7e6;
    border-radius: 3px;
    min-height: 24px;
    transition: top 0.05s linear;
  }
</style>
</head><body>
<div id="scroll-track"><div id="scroll-thumb"></div></div>
<script src="${src}"><\/script>
<script>
  (function () {
    var thumb = document.getElementById('scroll-thumb');
    function update() {
      var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      var scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      var viewHeight = document.documentElement.clientHeight;
      if (scrollHeight <= 0) { thumb.style.height = '100%'; thumb.style.top = '0'; return; }
      var ratio = viewHeight / document.documentElement.scrollHeight;
      var thumbH = Math.max(ratio * viewHeight, 24);
      var thumbTop = (scrollTop / scrollHeight) * (viewHeight - thumbH);
      thumb.style.height = thumbH + 'px';
      thumb.style.top = thumbTop + 'px';
    }
    document.addEventListener('scroll', update, { passive: true });
    window.addEventListener('resize', update);
    setTimeout(update, 500);
  })();
<\/script>
</body></html>`);
                                doc.close();
                                // Auto-resize iframe to fit content after Gist loads
                                gistFrame.addEventListener('load', () => {
                                    try {
                                        const h = gistFrame.contentDocument.body.scrollHeight;
                                        if (h > 0) gistFrame.style.height = Math.min(h, 500) + 'px';
                                    } catch (_) { }
                                });
                            }
                            openSub(item);
                        }
                    });
                });
            });

        })();

        // Badge 3D rotation interaction
        (function () {
            const badges = document.querySelectorAll('.media-item');

            badges.forEach(badge => {
                badge.addEventListener('mousemove', (e) => {
                    const rect = badge.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const width = rect.width;

                    // Calculate rotation based on cursor position
                    // x position ranges from 0 (left) to width (right)
                    // Map to rotation from +20deg (left) to -20deg (right)
                    const normalizedX = (x / width) - 0.5; // Range: -0.5 to 0.5
                    const rotateY = -normalizedX * 40; // Range: +20 to -20 degrees

                    // Apply transform with smooth transition
                    badge.style.transform = `rotateY(${rotateY}deg)`;
                    badge.style.transition = 'transform 0.1s ease-out';
                });

                badge.addEventListener('mouseleave', () => {
                    // Reset to neutral rotation with smooth animation
                    badge.style.transform = 'rotateY(0deg)';
                    badge.style.transition = 'transform 0.5s ease-out';
                });
            });
        })();

        // SVG Zoom and Pan functionality
        (function () {
            const container = document.querySelector('.svg-zoom-container');
            if (!container) return;

            const img = container.querySelector('.zoomable-svg');
            const zoomInBtn = container.querySelector('.zoom-in');
            const zoomOutBtn = container.querySelector('.zoom-out');
            const resetBtn = container.querySelector('.zoom-reset');

            const MIN_SCALE = 1;
            const MAX_SCALE = 5;
            const ZOOM_FACTOR = 1.2;

            let scale = 1;
            let translateX = 0;
            let translateY = 0;

            let isPointerDown = false;
            let activePointerId = null;
            let dragStartX = 0;
            let dragStartY = 0;

            let rafId = null;

            container.style.touchAction = 'none';
            img.style.willChange = 'transform';
            img.draggable = false;
            img.addEventListener('dragstart', (e) => e.preventDefault());

            function getBaseImageSize() {
                const containerWidth = container.clientWidth;
                if (img.naturalWidth && img.naturalHeight) {
                    return {
                        width: containerWidth,
                        height: containerWidth * (img.naturalHeight / img.naturalWidth)
                    };
                }

                const rect = img.getBoundingClientRect();
                return {
                    width: containerWidth,
                    height: rect.height || container.clientHeight
                };
            }

            function clampPan() {
                const { width: baseWidth, height: baseHeight } = getBaseImageSize();
                const containerWidth = container.clientWidth;
                const containerHeight = container.clientHeight;

                const scaledWidth = baseWidth * scale;
                const scaledHeight = baseHeight * scale;

                let minX = containerWidth - scaledWidth;
                let maxX = 0;
                let minY = containerHeight - scaledHeight;
                let maxY = 0;

                if (scaledWidth <= containerWidth) {
                    minX = maxX = (containerWidth - scaledWidth) / 2;
                }

                if (scaledHeight <= containerHeight) {
                    minY = maxY = (containerHeight - scaledHeight) / 2;
                }

                translateX = Math.min(maxX, Math.max(minX, translateX));
                translateY = Math.min(maxY, Math.max(minY, translateY));
            }

            function render() {
                rafId = null;
                img.style.transform = `translate3d(${translateX}px, ${translateY}px, 0) scale(${scale})`;
            }

            function requestRender() {
                if (rafId) return;
                rafId = requestAnimationFrame(render);
            }

            function zoomAt(nextScale, clientX, clientY) {
                const boundedScale = Math.min(MAX_SCALE, Math.max(MIN_SCALE, nextScale));
                if (boundedScale === scale) return;

                const rect = container.getBoundingClientRect();
                const cx = clientX - rect.left;
                const cy = clientY - rect.top;

                const worldX = (cx - translateX) / scale;
                const worldY = (cy - translateY) / scale;

                scale = boundedScale;
                translateX = cx - worldX * scale;
                translateY = cy - worldY * scale;

                clampPan();
                requestRender();
            }

            function resetView() {
                scale = 1;
                translateX = 0;
                translateY = 0;
                clampPan();
                requestRender();
            }

            zoomInBtn.addEventListener('click', () => {
                const rect = container.getBoundingClientRect();
                zoomAt(scale * ZOOM_FACTOR, rect.left + rect.width / 2, rect.top + rect.height / 2);
            });

            zoomOutBtn.addEventListener('click', () => {
                const rect = container.getBoundingClientRect();
                zoomAt(scale / ZOOM_FACTOR, rect.left + rect.width / 2, rect.top + rect.height / 2);
            });

            resetBtn.addEventListener('click', resetView);

            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                const nextScale = e.deltaY > 0 ? scale / ZOOM_FACTOR : scale * ZOOM_FACTOR;
                zoomAt(nextScale, e.clientX, e.clientY);
            }, { passive: false });

            container.addEventListener('pointerdown', (e) => {
                if (e.target.closest('.zoom-controls')) return;
                if (e.button !== 0) return;

                e.preventDefault();

                isPointerDown = true;
                activePointerId = e.pointerId;
                dragStartX = e.clientX - translateX;
                dragStartY = e.clientY - translateY;

                container.style.cursor = 'grabbing';
                if (typeof container.setPointerCapture === 'function') {
                    try {
                        container.setPointerCapture(e.pointerId);
                    } catch (_) {
                        // Some browsers may throw here; dragging still works via window listeners below.
                    }
                }
            });

            window.addEventListener('pointermove', (e) => {
                if (!isPointerDown || e.pointerId !== activePointerId) return;

                translateX = e.clientX - dragStartX;
                translateY = e.clientY - dragStartY;
                clampPan();
                requestRender();
            });

            function endPan(e) {
                if (!isPointerDown || e.pointerId !== activePointerId) return;
                isPointerDown = false;
                activePointerId = null;
                container.style.cursor = 'grab';
                if (typeof container.hasPointerCapture === 'function' &&
                    typeof container.releasePointerCapture === 'function' &&
                    container.hasPointerCapture(e.pointerId)) {
                    container.releasePointerCapture(e.pointerId);
                }
            }

            window.addEventListener('pointerup', endPan);
            window.addEventListener('pointercancel', endPan);

            window.addEventListener('resize', () => {
                clampPan();
                requestRender();
            });

            if (img.complete) {
                resetView();
            } else {
                img.addEventListener('load', resetView, { once: true });
            }
        })();
    </script>

</body>

</html>